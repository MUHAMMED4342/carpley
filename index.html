<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>EriÅŸilebilir Araba YarÄ±ÅŸÄ± â€“ GÃ¼Ã§lÃ¼ Ses (FIX)</title>

<style>
body{
    background:#000;
    color:#fff;
    font-family:sans-serif;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    margin:0;
}
#game{
    border:4px solid #0f0;
    padding:40px;
    width:85%;
    text-align:center;
}
button{
    font-size:2rem;
    padding:20px 40px;
    background:#0f0;
    color:#000;
    border:none;
}
#status{
    font-size:2rem;
    color:#ff0;
    min-height:3em;
    margin-top:20px;
}
.stats{
    font-size:1.5rem;
    color:#0ff;
}
.hidden{display:none;}
</style>
</head>

<body>
<div id="game" role="main">
<h1>SÃ¼per GÃ¼Ã§lÃ¼ YarÄ±ÅŸ</h1>
<button id="startBtn">OYUNU BAÅžLAT</button>

<div id="status" aria-live="assertive">BaÅŸlat</div>

<div id="stats" class="hidden">
<div class="stats">HÄ±z: <span id="speedVal">0</span></div>
<div class="stats">Bonus: <span id="bonusVal">0</span></div>
<div class="stats">Turbo: <span id="powerVal">1</span></div>
</div>
</div>

<audio id="sndStart" src="sounds/start.mp3"></audio>
<audio id="sndKontak" src="sounds/kontak.mp3"></audio>
<audio id="sndMotor" src="sounds/car.mp3" loop></audio>
<audio id="sndBonus" src="sounds/bonus.mp3"></audio>
<audio id="sndFinish" src="sounds/finis.mp3"></audio>

<script>
/* ==========================
   WEB AUDIO
========================== */
const AudioCtx = window.AudioContext || window.webkitAudioContext;
const audioCtx = new AudioCtx();

const motor = document.getElementById("sndMotor");
motor.muted = true; // ðŸ”¥ KRÄ°TÄ°K SATIR

const src = audioCtx.createMediaElementSource(motor);
const gain = audioCtx.createGain();
const bass = audioCtx.createBiquadFilter();

bass.type = "lowshelf";
bass.frequency.value = 180;

src.connect(bass);
bass.connect(gain);
gain.connect(audioCtx.destination);

gain.gain.value = 0.8;

/* ==========================
   DEÄžÄ°ÅžKENLER
========================== */
let state="idle", speed=0, bonus=0, turbo=0, bonusActive=false;

/* ==========================
   MOTOR
========================== */
function updateMotor(){
    motor.playbackRate = Math.min(1 + speed/900 + turbo*0.6, 6);
    gain.gain.value = Math.min(0.8 + turbo*0.3, 2);
    bass.gain.value = Math.min(turbo*6, 30);
}

/* ==========================
   BAÅžLAT
========================== */
startBtn.onclick = async ()=>{
    await audioCtx.resume();
    startBtn.classList.add("hidden");
    sndStart.play();
    state="ready";
    status.innerText="ENTER ile motoru Ã§alÄ±ÅŸtÄ±r";
};

/* ==========================
   TUÅžLAR
========================== */
window.addEventListener("keydown", e=>{
    if(state==="running" && ["ArrowUp","ArrowLeft","ArrowRight"].includes(e.key))
        e.preventDefault();

    if(e.key==="Enter" && state==="ready"){
        state="running";
        sndKontak.play();
        motor.play(); // ðŸ”¥ SES ARTIK GELÄ°R
        stats.classList.remove("hidden");
        status.innerText="Gaz iÃ§in YUKARI OK";
        setInterval(spawnBonus,8000);
        setTimeout(endGame,90000);
    }

    if(e.key==="ArrowUp" && state==="running"){
        speed+=15;
        updateMotor();
        refresh();
    }

    if(e.key==="ArrowLeft" && bonusActive){
        bonusActive=false;
        bonus++;
        sndBonus.play();
        status.innerText="Bonus alÄ±ndÄ±";
        refresh();
    }

    if(e.key==="ArrowRight" && bonus>0){
        bonus--;
        turbo++;
        speed+=500;
        updateMotor();
        status.innerText="TURBO!";
        refresh();
    }
});

/* ==========================
   BONUS
========================== */
function spawnBonus(){
    if(state!=="running") return;
    bonusActive=true;
    sndBonus.currentTime=0;
    sndBonus.play();
    status.innerText="BONUS! SOL OK!";
    setTimeout(()=>bonusActive=false,3000);
}

/* ==========================
   BÄ°TÄ°Åž
========================== */
function endGame(){
    state="finished";
    motor.pause();
    sndFinish.play();
    status.innerText="YarÄ±ÅŸ bitti! Skor: "+speed;
}

/* ==========================
   GÃœNCELLE
========================== */
function refresh(){
    speedVal.innerText=speed;
    bonusVal.innerText=bonus;
    powerVal.innerText=turbo+1;
}
</script>
</body>
</html>
